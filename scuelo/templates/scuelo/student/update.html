{% extends "/home/humbu/sigpoc/templates/layout.html" %}

{% block content %}
<div class="container mt-4" style="max-width: 95%; margin: 0 auto;">
    <h1>Update Student Information</h1>
    
    <form method="post">
        {% csrf_token %}
        
        <!-- Student Update Form -->
        <div class="card mb-4">
            <div class="card-header">Basic Information</div>
            <div class="card-body">
                {{ form.as_p }}
            </div>
        </div>

        <!-- Inscription Formset -->
        <div class="card mb-4">
            <div class="card-header">Inscriptions</div>
            <div class="card-body">
                {{ inscription_formset.management_form }}
                {% for form in inscription_formset %}
                    <div class="card mb-2">
                        <div class="card-body">
                            {{ form.as_p }}
                        </div>
                    </div>
                {% endfor %}
                <button type="button" class="btn btn-secondary" id="add-inscription">Add Inscription</button>
            </div>
        </div>

        <button type="submit" class="btn btn-primary">Save Changes</button>
    </form>

    <a href="{% url 'student_detail' pk=object.pk class_id=object.classe.id %}" class="btn btn-secondary mt-3">Back to Details</a>
</div>

<script>
    document.getElementById('add-inscription').addEventListener('click', function() {
        var totalForms = document.getElementById('id_inscription_set-TOTAL_FORMS');
        var currentCount = parseInt(totalForms.value);
        var newForm = document.createElement('div');
        newForm.innerHTML = '{{ inscription_formset.empty_form.as_p|escapejs }}'.replace(/__prefix__/g, currentCount);
        totalForms.value = currentCount + 1;
        this.parentNode.insertBefore(newForm, this);
    });
</script>
{% endblock %}